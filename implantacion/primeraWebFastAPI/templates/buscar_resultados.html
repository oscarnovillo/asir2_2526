{% extends "base.html" %}

{% block title %}Resultados de B√∫squeda - Mi Primera Web FastAPI{% endblock %}

{% block content %}
<div class="card">
    <h2>üîç Resultados de B√∫squeda</h2>
    <p>B√∫squeda realizada con par√°metros POST desde formulario.</p>
    
    <div class="filtros">
        <h3>üìã Par√°metros de b√∫squeda utilizados:</h3>
        <ul>
            <li><strong>T√©rmino:</strong> "{{ termino }}"</li>
            {% if precio_min %}
                <li><strong>Precio m√≠nimo:</strong> {{ precio_min }}‚Ç¨</li>
            {% endif %}
            {% if precio_max %}
                <li><strong>Precio m√°ximo:</strong> {{ precio_max }}‚Ç¨</li>
            {% endif %}
        </ul>
    </div>
</div>

<div class="card">
    <h2>üì¶ Productos encontrados</h2>
    
    {% if resultados %}
        <p class="mensaje-exito">Se encontraron <strong>{{ resultados|length }}</strong> productos que coinciden con tu b√∫squeda.</p>
        
        <div class="productos-grid">
            {% for producto in resultados %}
                <div class="producto-card">
                    <h3>{{ producto.nombre }}</h3>
                    <p class="precio">üí∞ {{ "%.2f"|format(producto.precio) }}‚Ç¨</p>
                    <span class="categoria">{{ producto.categoria }}</span>
                    <div style="margin-top: 1rem;">
                        <a href="/producto/{{ producto.id }}" class="btn">Ver detalles</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="mensaje-error">
            <h3>‚ùå No se encontraron productos</h3>
            <p>No hay productos que coincidan con los criterios de b√∫squeda:</p>
            <ul>
                <li>T√©rmino: "<strong>{{ termino }}</strong>"</li>
                {% if precio_min or precio_max %}
                    <li>Rango de precio: 
                        {% if precio_min %}{{ precio_min }}‚Ç¨{% else %}0‚Ç¨{% endif %} - 
                        {% if precio_max %}{{ precio_max }}‚Ç¨{% else %}‚àû{% endif %}
                    </li>
                {% endif %}
            </ul>
            
            <h4>üí° Sugerencias:</h4>
            <ul>
                <li>Prueba con t√©rminos m√°s generales</li>
                <li>Ampl√≠a el rango de precios</li>
                <li>Revisa la ortograf√≠a</li>
                <li>Prueba buscando: "port√°til", "mesa" o "libro"</li>
            </ul>
        </div>
    {% endif %}
    
    <div style="text-align: center; margin-top: 2rem;">
        <a href="/productos" class="btn">üì¶ Ver todos los productos</a>
        <a href="/" class="btn btn-success">üè† Volver al inicio</a>
    </div>
</div>

<div class="card">
    <h2>üîç Nueva b√∫squeda</h2>
    <form action="/buscar" method="post">
        <div class="filtros-inline">
            <div class="form-group">
                <label for="termino">T√©rmino de b√∫squeda:</label>
                <input type="text" id="termino" name="termino" value="{{ termino }}" placeholder="Nombre del producto..." required>
            </div>
            <div class="form-group">
                <label for="precio_min">Precio m√≠nimo (‚Ç¨):</label>
                <input type="number" id="precio_min" name="precio_min" value="{{ precio_min or '' }}" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
                <label for="precio_max">Precio m√°ximo (‚Ç¨):</label>
                <input type="number" id="precio_max" name="precio_max" value="{{ precio_max or '' }}" step="0.01" min="0" placeholder="999.99">
            </div>
            <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn">üîç Buscar</button>
            </div>
        </div>
    </form>
</div>

<div class="card">
    <h2>üéì Lo que aprender√°s aqu√≠</h2>
    <ul>
        <li><strong>Formularios POST con m√∫ltiples par√°metros:</strong> Texto y n√∫meros</li>
        <li><strong>Par√°metros opcionales:</strong> <code>Optional[float] = Form(None)</code></li>
        <li><strong>B√∫squeda en texto:</strong> <code>termino.lower() in producto.nombre.lower()</code></li>
        <li><strong>Filtrado por rangos:</strong> Comparaciones num√©ricas con precios</li>
        <li><strong>Combinaci√≥n de filtros:</strong> M√∫ltiples condiciones AND</li>
        <li><strong>Preservaci√≥n de valores:</strong> Mantener datos del formulario en nueva b√∫squeda</li>
    </ul>
    
    <h3>üîß L√≥gica de b√∫squeda:</h3>
    <pre style="background: #f8f9fa; padding: 1rem; border-radius: 4px; overflow-x: auto;">
for producto in productos_db:
    # Buscar por nombre
    if termino.lower() in producto["nombre"].lower():
        # Filtrar por precio m√≠nimo
        if precio_min and producto["precio"] < precio_min:
            continue
        # Filtrar por precio m√°ximo
        if precio_max and producto["precio"] > precio_max:
            continue
        resultados.append(producto)</pre>
</div>

<div class="card">
    <h2>üß™ Pruebas sugeridas</h2>
    <div class="filtros">
        <h3>B√∫squedas que encontrar√°n resultados:</h3>
        <ul>
            <li><strong>"port√°til"</strong> - Encontrar√° el port√°til</li>
            <li><strong>"mesa"</strong> - Encontrar√° la mesa</li>
            <li><strong>"libro"</strong> - Encontrar√° el libro</li>
            <li><strong>Precio 0-200‚Ç¨</strong> - Mesa y libro</li>
            <li><strong>Precio 800-1000‚Ç¨</strong> - Solo el port√°til</li>
        </ul>
        
        <h3>B√∫squedas que NO encontrar√°n resultados:</h3>
        <ul>
            <li><strong>"tel√©fono"</strong> - No existe ese producto</li>
            <li><strong>Precio 1000-2000‚Ç¨</strong> - Ning√∫n producto en ese rango</li>
            <li><strong>"mesa" con precio 500-1000‚Ç¨</strong> - La mesa es m√°s barata</li>
        </ul>
    </div>
</div>
{% endblock %}
